AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: >
  go-sam-sanity
  
  Sample SAM Template for go-sam-sanity

Parameters:
  DomainName:
    Type: String
  ACMCertificateArn:
    Type: String
  HostedZoneId:
    Type: String

Resources:
  MyApi:
      Type: AWS::Serverless::Api
      Properties:
        StageName: Dev
        Domain:
          DomainName: !Ref DomainName
          CertificateArn: !Ref ACMCertificateArn
          EndpointConfiguration: EDGE
          Route53:
            HostedZoneId: !Ref HostedZoneId

  HelloWorldFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: hello-world/
      Handler: hello-world
      Runtime: go1.x
      Events:
        ProxyApiRoot:
          Type: Api
          Properties:
            RestApiId: !Ref MyApi
            Method: Get
            Path: /
        ProxyApiGreedy:
          Type: Api
          Properties:
            RestApiId: !Ref MyApi
            Path: /{proxy+}
            Method: ANY
      Policies:
        - SNSPublishMessagePolicy:
            TopicName: !GetAtt SendSnsTopic.TopicName
      Environment:
        Variables:
          SNS_TOPIC_ARN: !Ref SendSnsTopic

  SendSnsTopic:
    Type: AWS::SNS::Topic
    Properties:
      Subscription:
        - Endpoint: kai.hendry+snstest@gmail.com
          Protocol: email

Outputs:
  HelloWorldFunction:
    Description: "First Lambda Function ARN"
    Value: !GetAtt HelloWorldFunction.Arn
  HelloWorldFunctionIamRole:
    Description: "Implicit IAM Role created for Hello World function"
    Value: !GetAtt HelloWorldFunctionRole.Arn
